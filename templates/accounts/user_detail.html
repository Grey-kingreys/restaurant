{% extends 'base.html' %}

{% block title %}DÃ©tails : {{ user_obj.login }} - Admin{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-indigo-50 to-purple-100 py-4 sm:py-8 px-4">
    <div class="max-w-5xl mx-auto">

        <!-- En-tÃªte -->
        <div class="bg-white rounded-2xl shadow-xl p-4 sm:p-6 mb-4 sm:mb-6 border-t-4 border-indigo-500">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-3 sm:mb-4">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-3 sm:mb-0">ğŸ‘¤ DÃ©tails de l'utilisateur</h1>
                <a href="{% url 'accounts:user_list' %}"
                    class="px-4 sm:px-6 py-2 sm:py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-colors text-center text-sm sm:text-base">
                    â† Retour Ã  la liste
                </a>
            </div>

            <div class="flex items-center gap-3 sm:gap-4">
                <div class="text-4xl sm:text-5xl md:text-6xl">
                    {% if user_obj.is_table %}ğŸª‘
                    {% elif user_obj.is_serveur %}ğŸ‘¨â€ğŸ³
                    {% elif user_obj.is_cuisinier %}ğŸ³
                    {% elif user_obj.is_comptable %}ğŸ’°
                    {% elif user_obj.is_admin %}ğŸ‘‘
                    {% endif %}
                </div>
                <div>
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-900">{{ user_obj.login }}</h2>
                    <p class="text-base sm:text-lg text-gray-600">{{ user_obj.get_role_display }}</p>
                    {% if user_obj == user %}
                    <span
                        class="inline-block mt-1 sm:mt-2 bg-blue-100 text-blue-800 px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-xs sm:text-sm font-semibold">
                        C'est vous
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Informations principales -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 mb-4 sm:mb-6">
            <!-- Carte statut -->
            <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 border-l-4 
                {% if user_obj.actif %}border-green-500{% else %}border-red-500{% endif %}">
                <h3 class="text-xs sm:text-sm font-semibold text-gray-600 uppercase mb-2 sm:mb-3">Statut du compte</h3>
                {% if user_obj.actif %}
                <div class="flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4">
                    <span class="text-3xl sm:text-4xl">âœ…</span>
                    <div>
                        <p class="text-lg sm:text-xl font-bold text-green-600">Actif</p>
                        <p class="text-xs sm:text-sm text-gray-600">Peut se connecter</p>
                    </div>
                </div>
                {% else %}
                <div class="flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4">
                    <span class="text-3xl sm:text-4xl">âŒ</span>
                    <div>
                        <p class="text-lg sm:text-xl font-bold text-red-600">Inactif</p>
                        <p class="text-xs sm:text-sm text-gray-600">Ne peut pas se connecter</p>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Carte rÃ´le -->
            <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 border-l-4 border-indigo-500">
                <h3 class="text-xs sm:text-sm font-semibold text-gray-600 uppercase mb-2 sm:mb-3">RÃ´le</h3>
                <div class="flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4">
                    <span class="text-3xl sm:text-4xl">
                        {% if user_obj.is_table %}ğŸª‘
                        {% elif user_obj.is_serveur %}ğŸ‘¨â€ğŸ³
                        {% elif user_obj.is_cuisinier %}ğŸ³
                        {% elif user_obj.is_comptable %}ğŸ’°
                        {% elif user_obj.is_admin %}ğŸ‘‘
                        {% endif %}
                    </span>
                    <div>
                        <p class="text-lg sm:text-xl font-bold text-indigo-600">{{ user_obj.get_role_display }}</p>
                        <p class="text-xs sm:text-sm text-gray-600">{{ user_obj.role }}</p>
                    </div>
                </div>
            </div>

            <!-- Carte dates -->
            <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 border-l-4 border-gray-500">
                <h3 class="text-xs sm:text-sm font-semibold text-gray-600 uppercase mb-2 sm:mb-3">Dates</h3>
                <div class="space-y-2 sm:space-y-3">
                    <div>
                        <p class="text-xs text-gray-500">CrÃ©Ã© le</p>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">{{ user_obj.date_creation|date:"d/m/Y Ã  H:i" }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- AprÃ¨s la carte "Dates", avant "Statistiques" -->

        <!-- Informations personnelles (si applicables) -->
        {% if not user_obj.is_table %}
        <div class="lg:col-span-3 mb-4 sm:mb-6">
            <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6">
                <h3 class="text-lg sm:text-xl font-bold text-gray-900 mb-4 sm:mb-6">ğŸ‘¤ Informations personnelles</h3>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 lg:gap-6">
                    <!-- Nom complet -->
                    <div class="bg-gray-50 rounded-xl p-3 sm:p-4">
                        <p class="text-xs text-gray-500 uppercase mb-1">Nom complet</p>
                        {% if user_obj.nom_complet %}
                        <p class="text-base sm:text-lg font-semibold text-gray-900">{{ user_obj.nom_complet }}</p>
                        {% else %}
                        <p class="text-sm text-gray-400 italic">Non renseignÃ©</p>
                        {% endif %}
                    </div>

                    <!-- Email -->
                    <div class="bg-gray-50 rounded-xl p-3 sm:p-4">
                        <p class="text-xs text-gray-500 uppercase mb-1">Email</p>
                        {% if user_obj.email %}
                        <p class="text-base sm:text-lg font-semibold text-gray-900 break-all">{{ user_obj.email }}</p>
                        {% else %}
                        <p class="text-sm text-gray-400 italic">Non renseignÃ©</p>
                        {% endif %}
                    </div>

                    <!-- TÃ©lÃ©phone -->
                    <div class="bg-gray-50 rounded-xl p-3 sm:p-4">
                        <p class="text-xs text-gray-500 uppercase mb-1">TÃ©lÃ©phone</p>
                        {% if user_obj.telephone %}
                        <p class="text-base sm:text-lg font-semibold text-gray-900">{{ user_obj.telephone }}</p>
                        {% else %}
                        <p class="text-sm text-gray-400 italic">Non renseignÃ©</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Statistiques selon le rÃ´le -->
        {% if extra_stats %}
        <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
            <h3 class="text-lg sm:text-xl font-bold text-gray-900 mb-4 sm:mb-6">ğŸ“Š Statistiques</h3>

            {% if user_obj.is_table %}
            <!-- Stats pour Table -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                <div class="bg-gray-50 rounded-xl p-3 sm:p-4">
                    <p class="text-xs sm:text-sm text-gray-600 mb-1">Total commandes</p>
                    <p class="text-xl sm:text-2xl md:text-3xl font-bold text-indigo-600">{{ extra_stats.total_commandes }}</p>
                </div>
                <div class="bg-yellow-50 rounded-xl p-3 sm:p-4">
                    <p class="text-xs sm:text-sm text-gray-600 mb-1">En attente</p>
                    <p class="text-xl sm:text-2xl md:text-3xl font-bold text-yellow-600">{{ extra_stats.commandes_en_attente }}</p>
                </div>
                <div class="bg-green-50 rounded-xl p-3 sm:p-4">
                    <p class="text-xs sm:text-sm text-gray-600 mb-1">PayÃ©es</p>
                    <p class="text-xl sm:text-2xl md:text-3xl font-bold text-green-600">{{ extra_stats.commandes_payees }}</p>
                </div>
                <div class="bg-blue-50 rounded-xl p-3 sm:p-4">
                    <p class="text-xs sm:text-sm text-gray-600 mb-1">Montant total</p>
                    <p class="text-lg sm:text-xl md:text-2xl font-bold text-blue-600">{{ extra_stats.montant_total }}
                        GNF</p>
                </div>
            </div>
            {% elif user_obj.is_comptable %}
            <!-- Stats pour Comptable -->
            <div class="bg-green-50 rounded-xl p-3 sm:p-4 inline-block">
                <p class="text-xs sm:text-sm text-gray-600 mb-1">DÃ©penses enregistrÃ©es</p>
                <p class="text-xl sm:text-2xl md:text-3xl font-bold text-green-600">{{ extra_stats.depenses_enregistrees }}</p>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Permissions du rÃ´le -->
        <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
            <h3 class="text-lg sm:text-xl font-bold text-gray-900 mb-4 sm:mb-6">ğŸ” Permissions et fonctionnalitÃ©s</h3>

            {% if user_obj.is_table %}
            <ul class="space-y-2 sm:space-y-3">
                <li class="flex items-start">
                    <span class="text-green-500 mr-2 sm:mr-3 text-lg sm:text-xl">âœ…</span>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">Consulter le menu</p>
                        <p class="text-xs sm:text-sm text-gray-600">Voir tous les plats disponibles</p>
                    </div>
                </li>
                <li class="flex items-start">
                    <span class="text-green-500 mr-2 sm:mr-3 text-lg sm:text-xl">âœ…</span>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">Commander des plats</p>
                        <p class="text-xs sm:text-sm text-gray-600">Ajouter au panier et valider une commande</p>
                    </div>
                </li>
                <li class="flex items-start">
                    <span class="text-green-500 mr-2 sm:mr-3 text-lg sm:text-xl">âœ…</span>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">Voir ses commandes</p>
                        <p class="text-xs sm:text-sm text-gray-600">Historique personnel uniquement</p>
                    </div>
                </li>
            </ul>

            {% elif user_obj.is_serveur %}
            <ul class="space-y-2 sm:space-y-3">
                <li class="flex items-start">
                    <span class="text-green-500 mr-2 sm:mr-3 text-lg sm:text-xl">âœ…</span>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">GÃ©rer les tables</p>
                        <p class="text-xs sm:text-sm text-gray-600">Voir l'Ã©tat de toutes les tables</p>
                    </div>
                </li>
                <li class="flex items-start">
                    <span class="text-green-500 mr-2 sm:mr-3 text-lg sm:text-xl">âœ…</span>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">Valider les commandes</p>
                        <p class="text-xs sm:text-sm text-gray-600">Marquer comme "servie"</p>
                    </div>
                </li>
                <li class="flex items-start">
                    <span class="text-green-500 mr-2 sm:mr-3 text-lg sm:text-xl">âœ…</span>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">Valider les paiements</p>
                        <p class="text-xs sm:text-sm text-gray-600">Marquer comme "payÃ©e" et mettre Ã  jour la caisse</p>
                    </div>
                </li>
            </ul>

            {% elif user_obj.is_cuisinier %}
            <ul class="space-y-2 sm:space-y-3">
                <li class="flex items-start">
                    <span class="text-green-500 mr-2 sm:mr-3 text-lg sm:text-xl">âœ…</span>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">GÃ©rer le menu</p>
                        <p class="text-xs sm:text-sm text-gray-600">CrÃ©er, modifier des plats</p>
                    </div>
                </li>
                <li class="flex items-start">
                    <span class="text-green-500 mr-2 sm:mr-3 text-lg sm:text-xl">âœ…</span>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">GÃ©rer les images</p>
                        <p class="text-xs sm:text-sm text-gray-600">Upload d'images de plats</p>
                    </div>
                </li>
                <li class="flex items-start">
                    <span class="text-green-500 mr-2 sm:mr-3 text-lg sm:text-xl">âœ…</span>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">Activer/DÃ©sactiver des plats</p>
                        <p class="text-xs sm:text-sm text-gray-600">GÃ©rer la disponibilitÃ©</p>
                    </div>
                </li>
            </ul>

            {% elif user_obj.is_comptable %}
            <ul class="space-y-2 sm:space-y-3">
                <li class="flex items-start">
                    <span class="text-green-500 mr-2 sm:mr-3 text-lg sm:text-xl">âœ…</span>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">Dashboard caisse</p>
                        <p class="text-xs sm:text-sm text-gray-600">Voir le solde et les statistiques</p>
                    </div>
                </li>
                <li class="flex items-start">
                    <span class="text-green-500 mr-2 sm:mr-3 text-lg sm:text-xl">âœ…</span>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">GÃ©rer les dÃ©penses</p>
                        <p class="text-xs sm:text-sm text-gray-600">Enregistrer et consulter les dÃ©penses</p>
                    </div>
                </li>
                <li class="flex items-start">
                    <span class="text-green-500 mr-2 sm:mr-3 text-lg sm:text-xl">âœ…</span>
                    <div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">Consulter les paiements</p>
                        <p class="text-xs sm:text-sm text-gray-600">Historique complet des paiements</p>
                    </div>
                </li>
            </ul>

            {% elif user_obj.is_admin %}
            <div class="bg-indigo-50 border-l-4 border-indigo-500 p-3 sm:p-4 rounded-r-lg">
                <p class="font-semibold text-indigo-900 mb-1 sm:mb-2 text-sm sm:text-base">ğŸ‘‘ Administrateur - AccÃ¨s
                    complet</p>
                <p class="text-xs sm:text-sm text-indigo-700">Toutes les fonctionnalitÃ©s du systÃ¨me sont accessibles</p>
            </div>
            {% endif %}
        </div>

        <!-- Actions -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
            <!-- Modifier -->
            {% if user_obj != user %}
            <a href="{% url 'accounts:user_update' user_obj.id %}"
                class="bg-white hover:bg-gray-50 border-2 border-gray-200 hover:border-orange-500 rounded-2xl p-4 sm:p-6 transition-all transform hover:scale-105 hover:shadow-xl">
                <div class="flex items-center">
                    <div class="text-3xl sm:text-4xl md:text-5xl mr-3 sm:mr-4">âœï¸</div>
                    <div>
                        <h3 class="font-bold text-gray-900 text-base sm:text-lg mb-1">Modifier l'utilisateur</h3>
                        <p class="text-gray-600 text-xs sm:text-sm">Changer le login, rÃ´le ou statut</p>
                    </div>
                </div>
            </a>
            {% endif %}

            <!-- RÃ©initialiser mot de passe -->
            {% if user_obj != user %}
            <a href="{% url 'accounts:user_reset_password' user_obj.id %}"
                class="bg-white hover:bg-gray-50 border-2 border-gray-200 hover:border-blue-500 rounded-2xl p-4 sm:p-6 transition-all transform hover:scale-105 hover:shadow-xl">
                <div class="flex items-center">
                    <div class="text-3xl sm:text-4xl md:text-5xl mr-3 sm:mr-4">ğŸ”‘</div>
                    <div>
                        <h3 class="font-bold text-gray-900 text-base sm:text-lg mb-1">RÃ©initialiser le mot de passe</h3>
                        <p class="text-gray-600 text-xs sm:text-sm">GÃ©nÃ©rer un nouveau mot de passe temporaire</p>
                    </div>
                </div>
            </a>
            {% endif %}

            <!-- Activer/DÃ©sactiver -->
            {% if user_obj != user %}
            <a href="{% url 'accounts:user_toggle_status' user_obj.id %}"
                onclick="return confirm('Voulez-vous {% if user_obj.actif %}dÃ©sactiver{% else %}activer{% endif %} ce compte ?')"
                class="bg-white hover:bg-gray-50 border-2 border-gray-200 hover:border-{% if user_obj.actif %}red{% else %}green{% endif %}-500 rounded-2xl p-4 sm:p-6 transition-all transform hover:scale-105 hover:shadow-xl">
                <div class="flex items-center">
                    <div class="text-3xl sm:text-4xl md:text-5xl mr-3 sm:mr-4">{% if user_obj.actif %}ğŸ”´{% else %}ğŸŸ¢{% endif %}</div>
                    <div>
                        <h3 class="font-bold text-gray-900 text-base sm:text-lg mb-1">
                            {% if user_obj.actif %}DÃ©sactiver{% else %}Activer{% endif %} le compte
                        </h3>
                        <p class="text-gray-600 text-xs sm:text-sm">
                            {% if user_obj.actif %}EmpÃªcher la connexion{% else %}Autoriser la connexion{% endif %}
                        </p>
                    </div>
                </div>
            </a>
            {% endif %}

            <!-- Supprimer -->
            {% if user_obj != user %}
            <a href="{% url 'accounts:user_delete' user_obj.id %}"
                class="bg-white hover:bg-red-50 border-2 border-gray-200 hover:border-red-500 rounded-2xl p-4 sm:p-6 transition-all transform hover:scale-105 hover:shadow-xl">
                <div class="flex items-center">
                    <div class="text-3xl sm:text-4xl md:text-5xl mr-3 sm:mr-4">ğŸ—‘ï¸</div>
                    <div>
                        <h3 class="font-bold text-red-600 text-base sm:text-lg mb-1">Supprimer l'utilisateur</h3>
                        <p class="text-gray-600 text-xs sm:text-sm">Action irrÃ©versible</p>
                    </div>
                </div>
            </a>
            {% endif %}
        </div>

        {% if user_obj == user %}
        <!-- Message si c'est son propre compte -->
        <div class="mt-4 sm:mt-6 bg-yellow-50 border-l-4 border-yellow-500 p-4 sm:p-6 rounded-r-2xl">
            <h3 class="font-semibold text-yellow-900 mb-1 sm:mb-2 text-sm sm:text-base">âš ï¸ Votre propre compte</h3>
            <p class="text-xs sm:text-sm text-yellow-700">
                Vous ne pouvez pas modifier, dÃ©sactiver ou supprimer votre propre compte via cette interface.
                Utilisez l'interface d'administration Django ou demandez Ã  un autre administrateur.
            </p>
        </div>
        {% endif %}

    </div>
</div>
{% endblock %}