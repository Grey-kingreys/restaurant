{% extends 'base.html' %}

{% block title %}QR Code - {{ table.login }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-indigo-50 to-purple-100 py-4 sm:py-8 px-4">
    <div class="max-w-4xl mx-auto">

        <!-- En-t√™te -->
        <div class="bg-white rounded-2xl shadow-xl p-4 sm:p-6 mb-4 sm:mb-6 border-t-4 border-indigo-500">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-3 sm:mb-4">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-3 sm:mb-0">üì± QR Code de Connexion</h1>
                <a href="{% url 'accounts:user_list' %}"
                    class="px-4 sm:px-6 py-2 sm:py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-colors text-center text-sm sm:text-base">
                    ‚Üê Retour
                </a>
            </div>
            <div class="flex items-center gap-3 sm:gap-4">
                <div class="text-4xl sm:text-6xl">ü™ë</div>
                <div>
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-900">{{ table.login }}</h2>
                    <p class="text-base sm:text-lg text-gray-600">Table Restaurant</p>
                </div>
            </div>
        </div>

        {% if token_obj and token_valide %}
        <!-- QR Code valide -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-4 sm:mb-6">

            <!-- QR Code -->
            <div class="bg-white rounded-2xl shadow-xl p-4 sm:p-6 md:p-8 text-center">
                <h3 class="text-lg sm:text-xl font-bold text-gray-900 mb-4 sm:mb-6">üì± Scannez ce QR Code</h3>

                <div class="bg-gray-50 rounded-xl p-4 sm:p-6 md:p-8 mb-4 sm:mb-6 inline-block">
                    <img src="{% url 'restaurant:qr_generate' table.id %}" alt="QR Code {{ table.login }}"
                        class="w-48 h-48 sm:w-56 sm:h-56 md:w-64 md:h-64 mx-auto">
                </div>

                <div class="space-y-2 sm:space-y-3">
                    <a href="{% url 'restaurant:qr_generate' table.id %}"
                        class="block w-full py-2.5 sm:py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-medium transition-colors shadow-lg text-sm sm:text-base"
                        download="qr_{{ table.login }}.png">
                        üíæ T√©l√©charger le QR Code
                    </a>

                    <button onclick="window.print()"
                        class="block w-full py-2.5 sm:py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-medium transition-colors shadow-lg text-sm sm:text-base">
                        üñ®Ô∏è Imprimer
                    </button>
                </div>
            </div>

            <!-- Instructions -->
            <div class="bg-white rounded-2xl shadow-xl p-4 sm:p-6 md:p-8">
                <h3 class="text-lg sm:text-xl font-bold text-gray-900 mb-4 sm:mb-6">üìã Instructions</h3>

                <div class="space-y-3 sm:space-y-4">
                    <div class="bg-blue-50 rounded-lg p-3 sm:p-4">
                        <h4 class="font-bold text-blue-900 mb-1 sm:mb-2 text-sm sm:text-base">1Ô∏è‚É£ Imprimer le QR Code
                        </h4>
                        <p class="text-xs sm:text-sm text-blue-700">
                            T√©l√©chargez ou imprimez le QR Code et placez-le sur la table physique.
                        </p>
                    </div>

                    <div class="bg-green-50 rounded-lg p-3 sm:p-4">
                        <h4 class="font-bold text-green-900 mb-1 sm:mb-2 text-sm sm:text-base">2Ô∏è‚É£ Scan par le client
                        </h4>
                        <p class="text-xs sm:text-sm text-green-700">
                            Le client scanne le QR avec son smartphone et est automatiquement connect√©.
                        </p>
                    </div>

                    <div class="bg-purple-50 rounded-lg p-3 sm:p-4">
                        <h4 class="font-bold text-purple-900 mb-1 sm:mb-2 text-sm sm:text-base">3Ô∏è‚É£ Session de 3 heures
                        </h4>
                        <p class="text-xs sm:text-sm text-purple-700">
                            La connexion expire automatiquement apr√®s 3 heures d'inactivit√©.
                        </p>
                    </div>
                </div>

                <!-- Informations du token -->
                <div class="mt-4 sm:mt-6 bg-gray-50 rounded-xl p-3 sm:p-4">
                    <h4 class="font-bold text-gray-900 mb-2 sm:mb-3 text-sm sm:text-base">‚ÑπÔ∏è Informations</h4>
                    <div class="space-y-1 sm:space-y-2 text-xs sm:text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">G√©n√©r√© le :</span>
                            <span class="font-semibold">{{ token_obj.date_creation|date:"d/m/Y √† H:i" }}</span>
                        </div>
                        {% if token_obj.date_derniere_utilisation %}
                        <div class="flex justify-between">
                            <span class="text-gray-600">Derni√®re utilisation :</span>
                            <span class="font-semibold">{{ token_obj.date_derniere_utilisation|date:"d/m/Y √† H:i"
                                }}</span>
                        </div>
                        {% endif %}
                        <div class="flex justify-between">
                            <span class="text-gray-600">Statut :</span>
                            <span class="font-semibold text-green-600">‚úÖ Valide</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- R√©g√©n√©rer -->
        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 sm:p-6 rounded-r-2xl">
            <h3 class="font-bold text-yellow-900 mb-1 sm:mb-2 text-sm sm:text-base">üîÑ R√©g√©n√©rer le QR Code</h3>
            <p class="text-xs sm:text-sm text-yellow-700 mb-3 sm:mb-4">
                Si vous avez modifi√© le mot de passe de cette table ou si vous souhaitez un nouveau QR Code,
                cliquez sur le bouton ci-dessous.
            </p>
            <a href="{% url 'restaurant:qr_generate' table.id %}"
                onclick="return confirm('Voulez-vous vraiment g√©n√©rer un nouveau QR Code ? L\'ancien ne fonctionnera plus.')"
                class="inline-block px-4 sm:px-6 py-2 sm:py-3 bg-yellow-600 hover:bg-yellow-700 text-white rounded-xl font-medium transition-colors text-sm sm:text-base">
                üîÑ G√©n√©rer un nouveau QR Code
            </a>
        </div>

        {% else %}
        <!-- Pas de QR Code ou invalide -->
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 md:p-12 text-center">
            <div class="text-6xl sm:text-7xl md:text-8xl mb-4 sm:mb-6">üì±</div>
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-3 sm:mb-4">
                {% if not token_obj %}
                Aucun QR Code g√©n√©r√©
                {% else %}
                ‚ö†Ô∏è QR Code invalide
                {% endif %}
            </h2>
            <p class="text-sm sm:text-base text-gray-600 mb-6 sm:mb-8">
                {% if not token_obj %}
                Cette table n'a pas encore de QR Code de connexion.
                {% else %}
                Le mot de passe de cette table a √©t√© modifi√©. L'ancien QR Code n'est plus valide.
                {% endif %}
            </p>
            <a href="{% url 'restaurant:qr_generate' table.id %}"
                class="inline-block px-6 sm:px-8 py-3 sm:py-4 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold transition-colors shadow-lg text-sm sm:text-base">
                ‚ú® G√©n√©rer un QR Code
            </a>
        </div>
        {% endif %}

        <!-- S√©curit√© -->
        <div class="mt-4 sm:mt-6 bg-red-50 border-l-4 border-red-500 p-4 sm:p-6 rounded-r-2xl">
            <h3 class="font-bold text-red-900 mb-1 sm:mb-2 text-sm sm:text-base">üîí S√©curit√©</h3>
            <ul class="text-xs sm:text-sm text-red-700 space-y-1">
                <li>‚Ä¢ Le QR Code devient invalide si vous changez le mot de passe de la table</li>
                <li>‚Ä¢ Chaque session client expire automatiquement apr√®s 3 heures</li>
                <li>‚Ä¢ Un nouveau scan cr√©e une nouvelle session de 3 heures</li>
                <li>‚Ä¢ Le QR Code est unique et ne peut pas √™tre devin√©</li>
            </ul>
        </div>

    </div>
</div>

<style>
    @media print {
        body * {
            visibility: hidden;
        }

        .bg-gray-50 img {
            visibility: visible;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
    }
</style>
{% endblock %}