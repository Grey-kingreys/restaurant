{% extends 'base.html' %}

{% block title %}QR Code - {{ table.login }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-indigo-50 to-purple-100 py-8 px-4">
    <div class="max-w-4xl mx-auto">

        <!-- En-t√™te -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 border-t-4 border-indigo-500">
            <div class="flex items-center justify-between mb-4">
                <h1 class="text-3xl font-bold text-gray-900">üì± QR Code de Connexion</h1>
                <a href="{% url 'accounts:user_list' %}"
                    class="px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-colors">
                    ‚Üê Retour
                </a>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-6xl">ü™ë</div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">{{ table.login }}</h2>
                    <p class="text-lg text-gray-600">Table Restaurant</p>
                </div>
            </div>
        </div>

        {% if token_obj and token_valide %}
        <!-- QR Code valide -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">

            <!-- QR Code -->
            <div class="bg-white rounded-2xl shadow-xl p-8 text-center">
                <h3 class="text-xl font-bold text-gray-900 mb-6">üì± Scannez ce QR Code</h3>

                <div class="bg-gray-50 rounded-xl p-8 mb-6 inline-block">
                    <img src="{% url 'restaurant:qr_generate' table.id %}" alt="QR Code {{ table.login }}"
                        class="w-64 h-64 mx-auto">
                </div>

                <div class="space-y-3">
                    <a href="{% url 'restaurant:qr_generate' table.id %}"
                        class="block w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-medium transition-colors shadow-lg"
                        download="qr_{{ table.login }}.png">
                        üíæ T√©l√©charger le QR Code
                    </a>

                    <button onclick="window.print()"
                        class="block w-full py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-medium transition-colors shadow-lg">
                        üñ®Ô∏è Imprimer
                    </button>
                </div>
            </div>

            <!-- Instructions -->
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <h3 class="text-xl font-bold text-gray-900 mb-6">üìã Instructions</h3>

                <div class="space-y-4">
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h4 class="font-bold text-blue-900 mb-2">1Ô∏è‚É£ Imprimer le QR Code</h4>
                        <p class="text-sm text-blue-700">
                            T√©l√©chargez ou imprimez le QR Code et placez-le sur la table physique.
                        </p>
                    </div>

                    <div class="bg-green-50 rounded-lg p-4">
                        <h4 class="font-bold text-green-900 mb-2">2Ô∏è‚É£ Scan par le client</h4>
                        <p class="text-sm text-green-700">
                            Le client scanne le QR avec son smartphone et est automatiquement connect√©.
                        </p>
                    </div>

                    <div class="bg-purple-50 rounded-lg p-4">
                        <h4 class="font-bold text-purple-900 mb-2">3Ô∏è‚É£ Session de 3 heures</h4>
                        <p class="text-sm text-purple-700">
                            La connexion expire automatiquement apr√®s 3 heures d'inactivit√©.
                        </p>
                    </div>
                </div>

                <!-- Informations du token -->
                <div class="mt-6 bg-gray-50 rounded-xl p-4">
                    <h4 class="font-bold text-gray-900 mb-3">‚ÑπÔ∏è Informations</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">G√©n√©r√© le :</span>
                            <span class="font-semibold">{{ token_obj.date_creation|date:"d/m/Y √† H:i" }}</span>
                        </div>
                        {% if token_obj.date_derniere_utilisation %}
                        <div class="flex justify-between">
                            <span class="text-gray-600">Derni√®re utilisation :</span>
                            <span class="font-semibold">{{ token_obj.date_derniere_utilisation|date:"d/m/Y √† H:i"
                                }}</span>
                        </div>
                        {% endif %}
                        <div class="flex justify-between">
                            <span class="text-gray-600">Statut :</span>
                            <span class="font-semibold text-green-600">‚úÖ Valide</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- R√©g√©n√©rer -->
        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 rounded-r-2xl">
            <h3 class="font-bold text-yellow-900 mb-2">üîÑ R√©g√©n√©rer le QR Code</h3>
            <p class="text-sm text-yellow-700 mb-4">
                Si vous avez modifi√© le mot de passe de cette table ou si vous souhaitez un nouveau QR Code,
                cliquez sur le bouton ci-dessous.
            </p>
            <a href="{% url 'restaurant:qr_generate' table.id %}"
                onclick="return confirm('Voulez-vous vraiment g√©n√©rer un nouveau QR Code ? L\'ancien ne fonctionnera plus.')"
                class="inline-block px-6 py-3 bg-yellow-600 hover:bg-yellow-700 text-white rounded-xl font-medium transition-colors">
                üîÑ G√©n√©rer un nouveau QR Code
            </a>
        </div>

        {% else %}
        <!-- Pas de QR Code ou invalide -->
        <div class="bg-white rounded-2xl shadow-xl p-12 text-center">
            <div class="text-8xl mb-6">üì±</div>
            <h2 class="text-2xl font-bold text-gray-900 mb-4">
                {% if not token_obj %}
                Aucun QR Code g√©n√©r√©
                {% else %}
                ‚ö†Ô∏è QR Code invalide
                {% endif %}
            </h2>
            <p class="text-gray-600 mb-8">
                {% if not token_obj %}
                Cette table n'a pas encore de QR Code de connexion.
                {% else %}
                Le mot de passe de cette table a √©t√© modifi√©. L'ancien QR Code n'est plus valide.
                {% endif %}
            </p>
            <a href="{% url 'restaurant:qr_generate' table.id %}"
                class="inline-block px-8 py-4 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold transition-colors shadow-lg">
                ‚ú® G√©n√©rer un QR Code
            </a>
        </div>
        {% endif %}

        <!-- S√©curit√© -->
        <div class="mt-6 bg-red-50 border-l-4 border-red-500 p-6 rounded-r-2xl">
            <h3 class="font-bold text-red-900 mb-2">üîí S√©curit√©</h3>
            <ul class="text-sm text-red-700 space-y-1">
                <li>‚Ä¢ Le QR Code devient invalide si vous changez le mot de passe de la table</li>
                <li>‚Ä¢ Chaque session client expire automatiquement apr√®s 3 heures</li>
                <li>‚Ä¢ Un nouveau scan cr√©e une nouvelle session de 3 heures</li>
                <li>‚Ä¢ Le QR Code est unique et ne peut pas √™tre devin√©</li>
            </ul>
        </div>

    </div>
</div>

<style>
    @media print {
        body * {
            visibility: hidden;
        }

        .bg-gray-50 img {
            visibility: visible;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
    }
</style>
{% endblock %}